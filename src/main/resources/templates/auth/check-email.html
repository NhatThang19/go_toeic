<!DOCTYPE html>
<html lang="vi"
      xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/auth-layout}">

<head>
    <th:block layout:fragment="extras-styles">
        <style>
            .btn-disabled-custom {
                color: #9CA3AF !important;
                cursor: not-allowed !important;
                text-decoration: none !important;
                pointer-events: none;
            }
        </style>
    </th:block>

</head>

<body>

<div layout:fragment="content">

    <div class="my-6 flex justify-center">
        <div class="w-24 h-24 bg-[#ECE9FA] rounded-full flex items-center justify-center text-[#422AD5] relative">
            <i class="fa-regular fa-envelope-open fa-3x"></i>
            <div class="absolute top-0 right-0 bg-green-500 rounded-full p-1.5 border-4 border-white">
                <i class="fa-solid fa-check text-white text-xs block"></i>
            </div>
        </div>
    </div>

    <h2 class="text-2xl font-bold text-gray-800 mb-2 text-center"
        th:text="${type == 'RESET_PASSWORD' ? 'Yêu cầu đặt lại mật khẩu' : 'Kiểm tra email của bạn'}">
        Kiểm tra email của bạn
    </h2>

    <p class="text-gray-500 text-sm mb-3 leading-relaxed text-center">
        Chúng tôi đã gửi
        <span th:text="${type == 'RESET_PASSWORD' ? 'hướng dẫn đặt lại mật khẩu' : 'một liên kết xác thực'}">liên kết</span>
        đến <br>
        <span class="font-semibold text-gray-800" th:text="${email ?: 'email@example.com'}">email@example.com</span>
        <br>
        <span th:text="${type == 'RESET_PASSWORD' ? 'Vui lòng nhấn vào liên kết để tạo mật khẩu mới.' : 'Vui lòng nhấn vào liên kết để kích hoạt tài khoản.'}"></span>
    </p>

    <div class="text-center mb-6">
        <div class="inline-flex items-center gap-1.5 px-3 py-1 bg-orange-50 text-orange-600 rounded-full text-xs font-medium">
            <i class="fa-regular fa-clock"></i>
            <span>Liên kết có hiệu lực trong <span th:text="${verifyTokenExpire}">15</span> phút</span>
        </div>
    </div>

    <div class="text-left bg-base-200 p-3 rounded-lg text-xs text-gray-600 mb-6 mx-auto max-w-xs">
        <p class="font-semibold mb-1">Không thấy email?</p>
        <ul class="list-disc list-inside space-y-0.5 pl-1">
            <li>Kiểm tra mục <strong>Spam</strong> hoặc <strong>Quảng cáo</strong>.</li>
            <li>Đợi khoảng vài phút để thư đến.</li>
        </ul>
    </div>

    <button class="btn w-full border-none hover-brand text-lg font-medium shadow-md shadow-indigo-200 mb-4"
            onclick="window.open('https://mail.google.com', '_blank')">
        Mở Gmail
    </button>

    <div class="text-sm text-gray-600 mb-6 flex flex-col justify-center items-center gap-2">
        <span>Bạn không nhận được email?</span>

        <form th:action="@{${type == 'RESET_PASSWORD' ? '/quen-mat-khau/gui-lai' : '/dang-ky/gui-lai'}}"
              method="post" id="resendForm">
            <input type="hidden" name="email" th:value="${email}"/>

            <button type="submit" id="resendBtn"
                    class="font-semibold text-brand hover:underline bg-transparent border-none cursor-pointer p-0 transition-colors hidden">
                Gửi lại email
            </button>
        </form>

        <span id="countdownText" class="text-gray-500">
            Vui lòng đợi <span id="countdownTimer" class="font-bold text-brand">30</span> giây để gửi lại.
        </span>
    </div>

    <div class="pt-6 border-t border-gray-100 w-full text-center">
        <a th:href="@{/dang-nhap}"
           class="inline-flex items-center justify-center gap-2 text-gray-500 hover:text-[#422AD5] transition-colors font-medium text-sm">
            <i class="fa-solid fa-arrow-left"></i> Quay lại đăng nhập
        </a>
    </div>
</div>

<th:block layout:fragment="extras-scripts">
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            let timeLeft = 30;
            const countdownTimerEl = document.getElementById('countdownTimer');
            const countdownTextEl = document.getElementById('countdownText');
            const resendBtnEl = document.getElementById('resendBtn');

            const startCountdown = () => {
                const interval = setInterval(() => {
                    timeLeft--;
                    countdownTimerEl.textContent = timeLeft;

                    if (timeLeft <= 0) {
                        clearInterval(interval);
                        countdownTextEl.classList.add('hidden');
                        resendBtnEl.classList.remove('hidden');
                    }
                }, 1000);
            };

            startCountdown();
        });
    </script>
</th:block>
</body>

</html>